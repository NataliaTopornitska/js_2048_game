class t{static gameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"};static getInitialState(){return[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}constructor(e=t.getInitialState()){this.gameStatus=t.gameStatus.idle,this.score=0,this.initialState=JSON.parse(JSON.stringify(e)),this.state=e}getEmptyTiles(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);return t}generateTile(t=1){let e=this.getEmptyTiles(),s=Math.min(t,e.length);if(e.length){for(let t=0;t<s;t++){let t=Math.floor(Math.random()*e.length),[s,a]=e.splice(t,1)[0];this.state[s][a]=Math.random()>=.9?4:2}this.updateBoard()}}updateBoard(){document.querySelectorAll(".field-row").forEach((t,e)=>{t.querySelectorAll(".field-cell").forEach((t,s)=>{let a=this.state[e][s];t.classList="field-cell",t.innerHTML="",0!==a&&(t.classList.add(`field-cell--${a}`),t.innerHTML=a)})}),this.isWin(),this.isLose()}isWin(){this.state.flat().some(e=>{2048===e&&(this.gameStatus=t.gameStatus.win)})}isLose(){if(!(this.getEmptyTiles().length>0)){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(t<3&&this.state[t][e]===this.state[t+1][e]||e<3&&this.state[t][e]===this.state[t][e+1])return;this.gameStatus=t.gameStatus.lose}}updateState(t){JSON.stringify(t)!==JSON.stringify(this.getState())&&(this.state=t,this.updateBoard(),this.generateTile())}moveLeft(){if(this.getStatus()!==t.gameStatus.playing)return;let e=this.getState().map(t=>this.compareAndMerge(t));this.updateState(e)}moveRight(){if(this.getStatus()!==t.gameStatus.playing)return;let e=this.getState().map(t=>this.compareAndMerge([...t].reverse())).map(t=>t.reverse());this.updateState(e)}moveUp(){if(this.getStatus()!==t.gameStatus.playing)return;let e=t.getInitialState();for(let t=0;t<4;t++){let s=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];s=this.compareAndMerge(s);for(let a=0;a<4;a++)e[a][t]=s[a]}this.updateState(e)}moveDown(){if(this.getStatus()!==t.gameStatus.playing)return;let e=t.getInitialState();for(let t=0;t<4;t++){let s=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];(s=this.compareAndMerge(s.reverse())).reverse();for(let a=0;a<4;a++)e[a][t]=s[a]}this.updateState(e)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.gameStatus}start(){this.gameStatus=t.gameStatus.playing,this.generateTile(2)}restart(){this.score=0,this.state=this.initialState,this.gameStatus=t.gameStatus.idle,this.updateBoard()}filterZero(t){return t.filter(t=>0!==t)}compareAndMerge(t){let e=this.filterZero(t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]+=e[t+1],e[t+1]=0,this.score+=e[t]);for(e=this.filterZero(e);e.length<4;)e.push(0);return e}}const e=new t,s=document.querySelector(".button"),a=document.querySelector(".game-score"),i=document.querySelector(".message-start"),r=document.querySelector(".message-lose"),l={idle:i,win:document.querySelector(".message-win"),lose:r};function n(){let t=e.getStatus();for(let e in l)l[e]&&l[e].classList.toggle("hidden",e!==t)}s.addEventListener("click",()=>{s.classList.contains("start")?(e.start(),s.classList.replace("start","restart"),s.innerHTML="Restart"):(e.restart(),a.innerHTML=e.getScore(),s.classList.replace("restart","start"),s.innerHTML="Start"),n()}),document.addEventListener("keyup",t=>{if("playing"===e.getStatus()){switch(t.code){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}a.innerHTML=e.getScore(),n()}});
//# sourceMappingURL=index.71ce9762.js.map
